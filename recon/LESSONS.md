Lessons learned:

1 - Write out files as compressed.

2 - Write out files with temporary names and then rename them, to indicate that they are complete. That way the operation is atomic and if the file is there, you know it's correct.
